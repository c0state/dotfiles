#----- detect platform
PLATFORM=$(uname)
IS_WSL=$(uname -a | grep -i microsoft >/dev/null; echo $?)

#----- always use full color terminal
export TERM=xterm-256color

#----- increase history file sizes
export HISTSIZE=10000
export HISTFILESIZE=20000

#----- set preferred editor and mode(s)
export EDITOR=vim
#set -o vi

source $HOME/.shell_aliases

#----- set based on platform (Linux or OS X)
if [[ $PLATFORM == 'Linux' ]]; then
  export PATH=$PATH:/usr/local/heroku/bin
  if [[ "$IS_WSL" == "0" ]]; then
    export DISPLAY=$(grep -m 1 nameserver /etc/resolv.conf | awk '{print $2}'):0.0
  fi
elif [[ $PLATFORM == 'Darwin' ]]; then
  # if homebrew is installed put it's bin dir first
  if [[ -e /usr/local/bin/brew ]]; then
    export PATH=/usr/local/opt/coreutils/libexec/gnubin:/usr/local/bin:/usr/local/sbin:$PATH
    export MANPATH="/usr/local/opt/coreutils/libexec/gnuman:$MANPATH"
  fi

  # if heroku toolbelt is installed
  if [[ -e "/usr/local/heroku/bin" ]]; then
    export PATH=/usr/local/heroku/bin:$PATH
  fi

  if [ -n "$BASH_VERSION" ]; then
    if [ -f $(brew --prefix)/share/bash-completion/bash_completion ]; then
      source $(brew --prefix)/share/bash-completion/bash_completion
    fi
  fi

  # use python 3
  if [[ -e "/usr/local/opt/python/libexec/bin" ]]; then
    export PATH=/usr/local/opt/python/libexec/bin:$PATH
  fi

  # add fastlane to path
  if [[ -e "$HOME/.fastlane/bin" ]]; then
    export PATH=$HOME/.fastlane/bin:$PATH
  fi

  if [[ -e "/usr/local/anaconda3/bin" ]]; then
    export PATH=/usr/local/anaconda3/bin:$PATH
  fi
fi 


#----- node config

# add yarn global bin path
if [[ -e "$HOME/.yarn/bin" ]]; then
  export PATH=$HOME/.yarn/bin:$PATH
fi

#----- add android sdk paths
if [[ -e "$HOME/Android/sdk" ]]; then
  export ANDROID_SDK_ROOT=$HOME/Android/sdk
elif [[ -e $HOME/Library/Android/sdk ]]; then
  export ANDROID_SDK_ROOT=$HOME/Library/Android/sdk
fi

if [[ -n "$ANDROID_SDK_ROOT" ]]; then
  export PATH=$PATH:$ANDROID_SDK_ROOT/platform-tools
  export PATH=$PATH:$ANDROID_SDK_ROOT/tools/bin
  export PATH=$PATH:$ANDROID_SDK_ROOT/emulator
fi

#----- add system agnostic apps to path
export PATH=$PATH:$HOME/bin:$HOME/.local/bin

# set up dircolors
eval $(dircolors $HOME/.dotfiles/.dircolors)

#----- php version manager
if [[ -e "${HOME}/.php-version" ]] ; then
  export PHP_VERSIONS="${HOME}/.php-version/versions"
  source $HOME/.php-version/php-version.sh && php-version 5
fi

#----- ruby
export PATH="$HOME/.rbenv/bin:$PATH"
if command -v rbenv >/dev/null; then
  eval "$(rbenv init -)"
fi

if command -v ruby >/dev/null && command -v gem >/dev/null; then
    PATH="$(ruby -r rubygems -e 'puts Gem.user_dir')/bin:$PATH"
fi

#----- golang
export GOPATH="$HOME/work/go"
export PATH="$HOME/.local/go/bin":$PATH

#----- rust
if [[ -e "$HOME/.cargo" ]]; then
    source "$HOME/.cargo/env"
fi

#----- git-subrepo
if [[ -e $HOME/.git-subrepo/.rc ]]; then
    source $HOME/.git-subrepo/.rc
fi

#----- python
export PYENV_ROOT=$HOME/.pyenv
export PATH="$PYENV_ROOT/bin:$PATH"
if command -v pyenv 1>/dev/null 2>&1; then
  eval "$(pyenv init -)"
  eval "$(pyenv virtualenv-init -)"
fi

export PATH=$PATH:$(python -m site --user-base)/bin
export PATH="$PATH:$HOME/.poetry/bin"

#----- deno
export PATH=$PATH:$HOME/.deno/bin

#----- docker
export DOCKER_BUILDKIT=1

#----- source any custom shell configuration
[[ -f $HOME/.shellrc_custom ]] && source $HOME/.shellrc_custom

